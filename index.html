<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>íƒ€ì¼ ë¸Œë ˆì´í¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
            touch-action: manipulation;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 400px;
            width: 100%;
        }

        .title {
            text-align: center;
            font-size: 2em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            background: linear-gradient(45deg, #e74c3c, #f39c12);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ë©”ì¸ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .main-menu {
            display: block;
        }

        .mode-selection {
            margin-bottom: 20px;
        }

        .mode-title {
            font-size: 1.3em;
            margin-bottom: 15px;
            text-align: center;
            color: #ecf0f1;
        }

        .mode-options {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .mode-option:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .mode-option.selected {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-color: #3498db;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .mode-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mode-desc {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .settings {
            margin-bottom: 20px;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-label {
            display: block;
            margin-bottom: 8px;
            font-size: 1em;
            color: #ecf0f1;
        }

        .speed-slider-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .speed-display {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #f39c12;
        }

        .speed-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            margin-bottom: 8px;
            -webkit-appearance: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f39c12, #e67e22);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .speed-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f39c12, #e67e22);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .speed-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            opacity: 0.7;
        }

        .records-section {
            margin-bottom: 20px;
        }

        .records-title {
            font-size: 1.1em;
            margin-bottom: 10px;
            text-align: center;
            color: #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .clear-records {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clear-records:hover {
            background: rgba(231, 76, 60, 0.3);
        }

        .records-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            margin-bottom: 4px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            font-size: 0.9em;
        }

        .record-rank {
            font-weight: bold;
            color: #f39c12;
            min-width: 30px;
        }

        .record-rank.gold { color: #f1c40f; }
        .record-rank.silver { color: #bdc3c7; }
        .record-rank.bronze { color: #d68910; }

        .record-score {
            font-weight: bold;
            color: #2ecc71;
        }

        .record-mode {
            font-size: 0.8em;
            color: #3498db;
        }

        .record-date {
            font-size: 0.7em;
            opacity: 0.7;
        }

        .no-records {
            text-align: center;
            opacity: 0.6;
            font-style: italic;
            padding: 20px;
        }

        .start-game-btn {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            border: none;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 15px;
        }

        .start-game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
        }

        /* ê²Œì„ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .game-screen {
            display: none;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .score {
            color: #2ecc71;
        }

        .speed {
            color: #f39c12;
        }

        .mode-indicator {
            color: #3498db;
            font-size: 0.9em;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            aspect-ratio: 1;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }

        .tile {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
        }

        .tile.active {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            animation: tileAppear 0.3s ease-out;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .tile.sequence {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            color: transparent;
            animation: tileAppear 0.3s ease-out;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .tile.locked {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            border-color: #95a5a6;
            animation: lockedBlink 0.5s ease-in-out infinite;
            cursor: not-allowed;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.4);
        }

        @keyframes lockedBlink {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .tile.active:hover, .tile.sequence:hover {
            transform: scale(1.05);
        }

        .tile.breaking {
            animation: tileBreak 0.3s ease-in;
        }

        @keyframes tileAppear {
            0% { 
                transform: scale(0);
                opacity: 0;
            }
            70% { 
                transform: scale(1.1);
            }
            100% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes tileBreak {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            50% { 
                transform: scale(1.2) rotate(10deg);
                opacity: 0.7;
            }
            100% { 
                transform: scale(0) rotate(45deg);
                opacity: 0;
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border: none;
            color: white;
            font-size: 1em;
            font-weight: bold;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .btn:hover, .btn:active {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.pause {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .btn.back {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .status {
            text-align: center;
            font-size: 1.1em;
            min-height: 30px;
            padding: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .game-over-popup {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 300px;
            margin: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            animation: popupShow 0.4s ease-out;
        }

        @keyframes popupShow {
            0% { transform: scale(0.7); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .popup-title {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .popup-score {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #f1c40f;
        }

        .popup-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 5px;
        }

        .popup-btn:hover, .popup-btn:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }

        .best-score {
            text-align: center;
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 10px;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
                    @media (max-width: 480px) {
            .container {
                padding: 15px;
                max-width: 350px;
            }
            
            .title {
                font-size: 1.6em;
            }
            
            .game-info {
                font-size: 1em;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.9em;
            }
            
            .records-container {
                max-height: 150px;
            }
            
            .record-item {
                padding: 6px 8px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">ğŸ’¥ íƒ€ì¼ ë¸Œë ˆì´í¬</h1>
        
        <!-- ë©”ì¸ ë©”ë‰´ -->
        <div class="main-menu" id="mainMenu">
            <div class="records-section">
                <div class="records-title">
                    <span>ğŸ† ê¸°ë¡ ìˆœìœ„</span>
                    <button class="clear-records" onclick="clearRecords()">ê¸°ë¡ ì‚­ì œ</button>
                </div>
                <div class="records-container" id="recordsContainer">
                    <div class="no-records">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </div>

            <div class="mode-selection">
                <div class="mode-title">ê²Œì„ ëª¨ë“œ ì„ íƒ</div>
                <div class="mode-options">
                    <div class="mode-option selected" data-mode="free" onclick="selectMode('free')">
                        <div class="mode-name">ğŸ¯ ììœ  ëª¨ë“œ</div>
                        <div class="mode-desc">ì•„ë¬´ íƒ€ì¼ì´ë‚˜ í„°ì¹˜í•´ì„œ íŒŒê´´</div>
                    </div>
                    <div class="mode-option" data-mode="sequence" onclick="selectMode('sequence')">
                        <div class="mode-name">ğŸ”¢ ìˆœì„œ ëª¨ë“œ</div>
                        <div class="mode-desc">ìˆ«ì ìˆœì„œëŒ€ë¡œ í„°ì¹˜í•´ì•¼ íŒŒê´´</div>
                    </div>
                </div>
            </div>

            <div class="settings">
                <div class="setting-item">
                    <label class="setting-label">ê²Œì„ ì†ë„ ì„¤ì •</label>
                    <div class="speed-slider-container">
                        <div class="speed-display">
                            <span id="speedDisplay">x1.0</span>
                        </div>
                        <input type="range" id="speedSlider" min="0.5" max="10.0" step="0.1" value="1.0" class="speed-slider">
                        <div class="speed-labels">
                            <span>x0.5</span>
                            <span>x5.0</span>
                            <span>x10.0</span>
                        </div>
                    </div>
                </div>
            </div>

            <button class="start-game-btn" onclick="startGameFromMenu()">ê²Œì„ ì‹œì‘ ğŸš€</button>
            
            <div class="best-score">
                ìµœê³  ì ìˆ˜: <span id="bestScore">0</span>
            </div>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div class="game-screen" id="gameScreen">
            <div class="game-info">
                <div class="score">ì ìˆ˜: <span id="score">0</span></div>
                <div class="mode-indicator" id="modeIndicator">ììœ  ëª¨ë“œ</div>
                <div class="speed">ì†ë„: <span id="speed">1.0x</span></div>
            </div>

            <div class="grid-container" id="gameGrid">
                <div class="tile" data-index="0"></div>
                <div class="tile" data-index="1"></div>
                <div class="tile" data-index="2"></div>
                <div class="tile" data-index="3"></div>
                <div class="tile" data-index="4"></div>
                <div class="tile" data-index="5"></div>
                <div class="tile" data-index="6"></div>
                <div class="tile" data-index="7"></div>
                <div class="tile" data-index="8"></div>
            </div>

            <div class="controls">
                <button class="btn back" onclick="backToMenu()">ë©”ë‰´</button>
                <button class="btn pause" id="pauseBtn" onclick="pauseGame()">ì¼ì‹œì •ì§€</button>
            </div>

            <div class="status" id="status">ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!</div>
        </div>
    </div>

    <div class="game-over" id="gameOverModal">
        <div class="game-over-popup">
            <div class="popup-title">ğŸ’€ ê²Œì„ ì˜¤ë²„!</div>
            <div class="popup-score">ì ìˆ˜: <span id="finalScore">0</span></div>
            <button class="popup-btn" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘</button>
            <button class="popup-btn" onclick="backToMenuFromGameOver()">ë©”ë‰´ë¡œ</button>
        </div>
    </div>

    <script>
        let gameState = {
            isPlaying: false,
            isPaused: false,
            score: 0,
            speed: 1.0,
            activeTiles: [],
            gameInterval: null,
            difficultyInterval: null,
            mode: 'free', // 'free' ë˜ëŠ” 'sequence'
            sequenceNumber: 1,
            nextTargetIndex: -1,
            speedMultiplier: 1.0
        };

        let gameConfig = {
            initialSpeed: 2000,
            speedIncrease: 0.1,
            scorePerTile: 10,
            speedIncreaseInterval: 15000
        };

        const tiles = document.querySelectorAll('.tile');
        const scoreElement = document.getElementById('score');
        const speedElement = document.getElementById('speed');
        const statusElement = document.getElementById('status');
        const bestScoreElement = document.getElementById('bestScore');
        const modeIndicatorElement = document.getElementById('modeIndicator');

        // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ìµœê³  ì ìˆ˜ ë¶ˆëŸ¬ì˜¤ê¸°
        let bestScore = 0;
        let gameRecords = [];
        
        try {
            bestScore = parseInt(localStorage.getItem('tileBreakBestScore')) || 0;
            gameRecords = JSON.parse(localStorage.getItem('tileBreakRecords')) || [];
        } catch (e) {
            bestScore = 0;
            gameRecords = [];
        }
        bestScoreElement.textContent = bestScore;

        // ì†ë„ ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
        const speedSlider = document.getElementById('speedSlider');
        const speedDisplay = document.getElementById('speedDisplay');
        
        speedSlider.addEventListener('input', function() {
            gameState.speedMultiplier = parseFloat(this.value);
            speedDisplay.textContent = 'x' + gameState.speedMultiplier.toFixed(1);
            // ì‹¤ì œ ì†ë„ ê³„ì‚° (ë†’ì€ ë°°ìˆ˜ = ë” ë¹ ë¥¸ ê²Œì„)
            gameConfig.initialSpeed = Math.round(2000 / gameState.speedMultiplier);
        });

        // íƒ€ì¼ í´ë¦­ ì´ë²¤íŠ¸
        tiles.forEach(function(tile, index) {
            tile.addEventListener('click', function(e) {
                e.preventDefault();
                breakTile(this);
            });
            
            tile.addEventListener('touchstart', function(e) {
                e.preventDefault();
                breakTile(this);
            });
        });

        function selectMode(mode) {
            gameState.mode = mode;
            
            // ì„ íƒëœ ëª¨ë“œ í‘œì‹œ
            document.querySelectorAll('.mode-option').forEach(function(option) {
                option.classList.remove('selected');
            });
            document.querySelector('[data-mode="' + mode + '"]').classList.add('selected');
        }

        function selectSpeed(speed) {
            // ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
        }

        function displayRecords() {
            const container = document.getElementById('recordsContainer');
            
            if (gameRecords.length === 0) {
                container.innerHTML = '<div class="no-records">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            // ì ìˆ˜ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedRecords = gameRecords.sort(function(a, b) {
                return b.score - a.score;
            });

            let html = '';
            sortedRecords.slice(0, 10).forEach(function(record, index) {
                let rankClass = '';
                let rankText = (index + 1) + 'ìœ„';
                
                if (index === 0) {
                    rankClass = 'gold';
                    rankText = 'ğŸ¥‡';
                } else if (index === 1) {
                    rankClass = 'silver';
                    rankText = 'ğŸ¥ˆ';
                } else if (index === 2) {
                    rankClass = 'bronze';
                    rankText = 'ğŸ¥‰';
                }

                const date = new Date(record.date);
                const dateStr = (date.getMonth() + 1) + '/' + date.getDate();
                const modeText = record.mode === 'free' ? 'ììœ ' : 'ìˆœì„œ';

                html += '<div class="record-item">';
                html += '<div class="record-rank ' + rankClass + '">' + rankText + '</div>';
                html += '<div class="record-score">' + record.score + 'ì </div>';
                html += '<div class="record-mode">' + modeText + '</div>';
                html += '<div class="record-date">' + dateStr + '</div>';
                html += '</div>';
            });

            container.innerHTML = html;
        }

        function saveRecord(score, mode) {
            const record = {
                score: score,
                mode: mode,
                date: Date.now()
            };

            gameRecords.push(record);
            
            // ìµœëŒ€ 50ê°œ ê¸°ë¡ë§Œ ìœ ì§€
            if (gameRecords.length > 50) {
                gameRecords = gameRecords.sort(function(a, b) {
                    return b.score - a.score;
                }).slice(0, 50);
            }

            try {
                localStorage.setItem('tileBreakRecords', JSON.stringify(gameRecords));
            } catch (e) {
                console.log('ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨');
            }

            displayRecords();
        }

        function clearRecords() {
            if (confirm('ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                gameRecords = [];
                bestScore = 0;
                try {
                    localStorage.removeItem('tileBreakRecords');
                    localStorage.removeItem('tileBreakBestScore');
                } catch (e) {
                    console.log('ê¸°ë¡ ì‚­ì œ ì‹¤íŒ¨');
                }
                bestScoreElement.textContent = '0';
                displayRecords();
            }
        }

        function startGameFromMenu() {
            // í™”ë©´ ì „í™˜
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            // ëª¨ë“œ í‘œì‹œ ì—…ë°ì´íŠ¸
            modeIndicatorElement.textContent = gameState.mode === 'free' ? 'ğŸ¯ ììœ  ëª¨ë“œ' : 'ğŸ”¢ ìˆœì„œ ëª¨ë“œ';
            
            startGame();
        }

        function startGame() {
            gameState.isPlaying = true;
            gameState.isPaused = false;
            gameState.score = 0;
            gameState.speed = 1.0;
            gameState.activeTiles = [];
            gameState.sequenceNumber = 1;
            gameState.nextTargetIndex = -1;

            updateDisplay();
            clearAllTiles();
            
            if (gameState.mode === 'free') {
                statusElement.textContent = 'íƒ€ì¼ì„ ë¹ ë¥´ê²Œ í„°ì¹˜í•˜ì„¸ìš”!';
            } else {
                statusElement.textContent = 'ìˆ«ì ìˆœì„œëŒ€ë¡œ í„°ì¹˜í•˜ì„¸ìš”!';
            }
            
            // ì²« ë²ˆì§¸ íƒ€ì¼ ì¦‰ì‹œ ìƒì„±
            createRandomTile();
            
            // íƒ€ì¼ ìƒì„± ì¸í„°ë²Œ ì‹œì‘
            gameState.gameInterval = setInterval(createRandomTile, gameConfig.initialSpeed);
            
            // ë‚œì´ë„ ì¦ê°€ ì¸í„°ë²Œ ì‹œì‘
            gameState.difficultyInterval = setInterval(increaseDifficulty, gameConfig.speedIncreaseInterval);
        }

        function pauseGame() {
            if (gameState.isPaused) {
                // ê²Œì„ ì¬ê°œ
                gameState.isPaused = false;
                document.getElementById('pauseBtn').textContent = 'ì¼ì‹œì •ì§€';
                statusElement.textContent = gameState.mode === 'free' ? 'íƒ€ì¼ì„ ë¹ ë¥´ê²Œ í„°ì¹˜í•˜ì„¸ìš”!' : 'ìˆ«ì ìˆœì„œëŒ€ë¡œ í„°ì¹˜í•˜ì„¸ìš”!';
                
                gameState.gameInterval = setInterval(createRandomTile, gameConfig.initialSpeed / gameState.speed);
                gameState.difficultyInterval = setInterval(increaseDifficulty, gameConfig.speedIncreaseInterval);
            } else {
                // ê²Œì„ ì¼ì‹œì •ì§€
                gameState.isPaused = true;
                document.getElementById('pauseBtn').textContent = 'ê³„ì†í•˜ê¸°';
                statusElement.textContent = 'ê²Œì„ì´ ì¼ì‹œì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤';
                
                clearInterval(gameState.gameInterval);
                clearInterval(gameState.difficultyInterval);
            }
        }

        function createRandomTile() {
            if (!gameState.isPlaying || gameState.isPaused) return;

            // ë¹ˆ íƒ€ì¼ ì°¾ê¸°
            const emptyTiles = [];
            tiles.forEach(function(tile, index) {
                if (!tile.classList.contains('active')) {
                    emptyTiles.push(index);
                }
            });

            // ëª¨ë“  íƒ€ì¼ì´ ì°¨ìˆìœ¼ë©´ ê²Œì„ ì˜¤ë²„
            if (emptyTiles.length === 0) {
                gameOver();
                return;
            }

            // ëœë¤í•œ ë¹ˆ íƒ€ì¼ ì„ íƒ
            const randomIndex = emptyTiles[Math.floor(Math.random() * emptyTiles.length)];
            const selectedTile = tiles[randomIndex];
            
            if (gameState.mode === 'free') {
                selectedTile.classList.add('active');
                gameState.activeTiles.push(randomIndex);
            } else {
                // ìˆœì„œ ëª¨ë“œ: ì¼ë°˜ ë¹¨ê°„ìƒ‰ íƒ€ì¼ë¡œ ìƒì„± (ììœ ëª¨ë“œì™€ ë™ì¼í•œ ëª¨ìŠµ)
                selectedTile.classList.add('active');
                selectedTile.textContent = '';
                gameState.activeTiles.push({index: randomIndex, number: gameState.sequenceNumber});
                
                // ì²« ë²ˆì§¸ íƒ€ì¼ì´ë©´ ë‹¤ìŒ íƒ€ê²Ÿìœ¼ë¡œ ì„¤ì • (ì‹œê°ì  ë³€í™” ì—†ìŒ)
                if (gameState.activeTiles.length === 1) {
                    gameState.nextTargetIndex = randomIndex;
                }
                
                gameState.sequenceNumber++;
            }
        }

        function updateNextTarget() {
            if (gameState.mode !== 'sequence' || gameState.activeTiles.length === 0) {
                return;
            }

            // ê°€ì¥ ì‘ì€ ìˆ«ì ì°¾ê¸° (ì‹œê°ì  í‘œì‹œ ì—†ì´ ë‚´ë¶€ì ìœ¼ë¡œë§Œ)
            let minNumber = Math.min.apply(Math, gameState.activeTiles.map(function(tile) {
                return tile.number;
            }));
            
            // í•´ë‹¹ ìˆ«ìì˜ íƒ€ì¼ ì¸ë±ìŠ¤ë§Œ ì €ì¥ (ì‹œê°ì  ë³€í™” ì—†ìŒ)
            gameState.activeTiles.forEach(function(tileData) {
                if (tileData.number === minNumber) {
                    gameState.nextTargetIndex = tileData.index;
                }
            });
        }

        function breakTile(tile) {
            if (!gameState.isPlaying || gameState.isPaused) {
                return;
            }

            const tileIndex = parseInt(tile.getAttribute('data-index'));
            
            // ì´ë¯¸ breaking ìƒíƒœì´ê±°ë‚˜ ê³ ì •ëœ íƒ€ì¼ì´ë©´ ë¬´ì‹œ
            if (tile.classList.contains('breaking') || tile.classList.contains('locked')) {
                if (tile.classList.contains('locked')) {
                    statusElement.textContent = 'ê³ ì •ëœ íƒ€ì¼ì…ë‹ˆë‹¤! ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”!';
                }
                return;
            }

            if (gameState.mode === 'free') {
                // ììœ  ëª¨ë“œ: í™œì„± íƒ€ì¼ë§Œ ê¹° ìˆ˜ ìˆìŒ
                if (!tile.classList.contains('active')) {
                    return;
                }
                
                // íƒ€ì¼ ê¹¨ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜
                tile.classList.add('breaking');
                
                // í™œì„± íƒ€ì¼ ëª©ë¡ì—ì„œ ì¦‰ì‹œ ì œê±°
                const activeIndex = gameState.activeTiles.indexOf(tileIndex);
                if (activeIndex > -1) {
                    gameState.activeTiles.splice(activeIndex, 1);
                }
                
                setTimeout(function() {
                    tile.classList.remove('active', 'breaking');
                }, 300);

                // ì ìˆ˜ ì¦ê°€
                gameState.score += gameConfig.scorePerTile;
                updateDisplay();
                
                statusElement.textContent = 'í›Œë¥­í•´ìš”! +' + gameConfig.scorePerTile + 'ì ';
                
            } else {
                // ìˆœì„œ ëª¨ë“œ: ì˜¬ë°”ë¥¸ ìˆœì„œì¸ì§€ í™•ì¸
                if (!tile.classList.contains('active')) {
                    return;
                }
                
                // ë‹¤ìŒ íƒ€ê²Ÿì´ ì•„ë‹ˆë©´ ì˜ëª»ëœ í„°ì¹˜ - íƒ€ì¼ ê³ ì • íŒ¨ë„í‹°
                if (tileIndex !== gameState.nextTargetIndex) {
                    // ì´ë¯¸ ê³ ì •ëœ íƒ€ì¼ì´ë©´ ë¬´ì‹œ
                    if (tile.classList.contains('locked')) {
                        statusElement.textContent = 'ê³ ì •ëœ íƒ€ì¼ì…ë‹ˆë‹¤! ë‹¤ë¥¸ íƒ€ì¼ì„ í„°ì¹˜í•˜ì„¸ìš”!';
                        return;
                    }
                    
                    // íƒ€ì¼ ê³ ì • (3ì´ˆê°„)
                    tile.classList.add('locked');
                    statusElement.textContent = 'ì˜ëª»ëœ ìˆœì„œ! íƒ€ì¼ì´ 3ì´ˆê°„ ê³ ì •ë©ë‹ˆë‹¤!';
                    
                    setTimeout(function() {
                        if (tile.classList.contains('locked')) {
                            tile.classList.remove('locked');
                        }
                    }, 3000);
                    
                    return;
                }
                
                // íƒ€ì¼ ê¹¨ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜
                tile.classList.add('breaking');
                
                // í™œì„± íƒ€ì¼ ëª©ë¡ì—ì„œ ì œê±°
                gameState.activeTiles = gameState.activeTiles.filter(function(tileData) {
                    return tileData.index !== tileIndex;
                });
                
                setTimeout(function() {
                    tile.classList.remove('active', 'breaking');
                    tile.textContent = '';
                }, 300);

                // ì ìˆ˜ ì¦ê°€
                gameState.score += gameConfig.scorePerTile;
                updateDisplay();
                
                // ë‹¤ìŒ íƒ€ê²Ÿ ì—…ë°ì´íŠ¸
                updateNextTarget();
                
                statusElement.textContent = 'ì •í™•í•´ìš”! +' + gameConfig.scorePerTile + 'ì ';
            }
        }

        function increaseDifficulty() {
            if (!gameState.isPlaying || gameState.isPaused) return;
            
            gameState.speed += gameConfig.speedIncrease;
            
            // ì¸í„°ë²Œ ì¬ì„¤ì • (ë” ë¹ ë¥´ê²Œ)
            clearInterval(gameState.gameInterval);
            gameState.gameInterval = setInterval(createRandomTile, gameConfig.initialSpeed / gameState.speed);
            
            updateDisplay();
            statusElement.textContent = 'ì†ë„ ì¦ê°€! ' + gameState.speed.toFixed(1) + 'x';
        }

        function gameOver() {
            gameState.isPlaying = false;
            clearInterval(gameState.gameInterval);
            clearInterval(gameState.difficultyInterval);
            
            // ìµœê³  ì ìˆ˜ í™•ì¸ ë° ì €ì¥
            if (gameState.score > bestScore) {
                bestScore = gameState.score;
                try {
                    localStorage.setItem('tileBreakBestScore', bestScore);
                } catch (e) {
                    console.log('ë¡œì»¬ ì €ì¥ì†Œ ì €ì¥ ì‹¤íŒ¨');
                }
                bestScoreElement.textContent = bestScore;
            }

            // ê¸°ë¡ ì €ì¥
            saveRecord(gameState.score, gameState.mode);
            
            // ê²Œì„ ì˜¤ë²„ íŒì—… í‘œì‹œ
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('gameOverModal').style.display = 'flex';
        }

        function restartGame() {
            document.getElementById('gameOverModal').style.display = 'none';
            clearAllTiles();
            startGame();
        }

        function backToMenu() {
            if (gameState.isPlaying) {
                clearInterval(gameState.gameInterval);
                clearInterval(gameState.difficultyInterval);
                gameState.isPlaying = false;
            }
            
            clearAllTiles();
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
        }

        function backToMenuFromGameOver() {
            document.getElementById('gameOverModal').style.display = 'none';
            backToMenu();
        }

        function clearAllTiles() {
            tiles.forEach(function(tile) {
                tile.classList.remove('active', 'breaking', 'locked');
                tile.textContent = '';
            });
            gameState.activeTiles = [];
            gameState.sequenceNumber = 1;
            gameState.nextTargetIndex = -1;
        }

        function updateDisplay() {
            scoreElement.textContent = gameState.score;
            speedElement.textContent = gameState.speed.toFixed(1) + 'x';
        }

        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬
        window.addEventListener('error', function(e) {
            console.log('ì—ëŸ¬ ë°œìƒ:', e.message);
        });

        // ê²Œì„ ì´ˆê¸° ìƒíƒœ ì„¤ì •
        updateDisplay();
        displayRecords();
    </script>
</body>
</html>
